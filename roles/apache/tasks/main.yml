-   name: Install apache
    apt:
        name: apache2
        state: present

-   name: Create vhost dir
    file:
        path: "{{ apacheroot }}/{{ vhostdir }}"
        state: directory

-   name: Update apache conf
    template:
        src: conf.j2
        dest: "{{ apacheroot }}/apache.conf"
    notify: reload apache

-   name: Update ports conf
    template:
        src: ports.j2
        dest: "{{ apacheroot }}/ports.conf"
    notify: reload apache

-   name: Delete obsolete dirs
    file:
        path: "{{ item }}"
        state: absent
    with_items:
        - "{{ apacheroot }}/sites-available"
        - "{{ apacheroot }}/sites-enabled"
    notify: restart apache
