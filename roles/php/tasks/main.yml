-   name: Importing ppa:ondrej/php PPA for multiple PHP version support
    apt_repository:
        repo: ppa:ondrej/php
        state: present

-   name: Updating packages
    apt:
        update_cache: yes

-   name: Installing selected PHP versions
    apt:
        name: php{{ item.key }}
        state: present
    with_items:
        - "{{ phpversions }}"

-   name: Installing PHP modules
    apt:
        name: {{ item.value }}
        state: present
    with_items:
        - "{{ phpversions }}"

-   name: Installing PHP-FPM
    apt:
        name: php{{ item }}-fpm
        state: present
    with_items:
        - "{{ phpversions }}"

-   name: Updating selected PHP ini values
    template:
        src: 10-serverpack.j2
        dest: /etc/php/{{ item }}/fpm/conf.d/10-serverpack.ini
    with_items:
        - "{{ phpversions }}"

-   name: Updating PHP-FPM configuration
    template:
        src: fpmconf.j2
        dest: /etc/php/{{ item }}/fpm/php-fpm.conf
    with_items:
        - "{{ phpversions }}"
    notify: reload php
